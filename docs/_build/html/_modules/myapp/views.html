
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>myapp.views &#8212; HECAT 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for myapp.views</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>

<span class="c1"># from .models import Document</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">DocumentForm</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">dss.dex</span> <span class="kn">import</span> <span class="n">DEXModel</span>
<span class="kn">from</span> <span class="nn">dss.esco_utils</span> <span class="kn">import</span> <span class="n">ESCOUtil</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">require_http_methods</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>
<span class="kn">from</span> <span class="nn">django.core.serializers</span> <span class="kn">import</span> <span class="n">serialize</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="c1"># from .utils import select_positions</span>
<span class="kn">import</span> <span class="nn">myapp.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;hecat&quot;</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">plot</span>
<span class="kn">from</span> <span class="nn">plotly.graph_objs</span> <span class="kn">import</span> <span class="n">Scatter</span><span class="p">,</span> <span class="n">Scatterpolar</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>



<div class="viewcode-block" id="NumpyEncoder"><a class="viewcode-back" href="../../myapp.html#myapp.views.NumpyEncoder">[docs]</a><span class="k">class</span> <span class="nc">NumpyEncoder</span><span class="p">(</span><span class="n">DjangoJSONEncoder</span><span class="p">):</span>
<div class="viewcode-block" id="NumpyEncoder.default"><a class="viewcode-back" href="../../myapp.html#myapp.views.NumpyEncoder.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="eval_hecat_dex"><a class="viewcode-back" href="../../myapp.html#myapp.views.eval_hecat_dex">[docs]</a><span class="nd">@require_http_methods</span><span class="p">([</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">eval_hecat_dex</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">dexmodel</span> <span class="o">=</span> <span class="n">DEXModel</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DEX_MODEL</span><span class="p">)</span>
    <span class="n">esco</span> <span class="o">=</span> <span class="n">ESCOUtil</span><span class="p">()</span>
    <span class="n">occupations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_occupation</span><span class="p">()</span>
    <span class="n">napoved_year</span> <span class="o">=</span> <span class="mi">2018</span>
    <span class="n">napoved_period</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>

    <span class="n">skp_skills</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">get_skp_skills</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># pd.read_pickle(&#39;./data/skp_skills_%d-%s.pcl&#39; % (napoved_year,napoved_period) )</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_merged</span><span class="p">()</span>
    <span class="n">complete_skills_dict</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_complete_skills_dict</span><span class="p">()</span>
    <span class="n">df_lang_dict</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_skp_lang</span><span class="p">()</span>
    <span class="n">id_distance_time</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_id_dist_time</span><span class="p">()</span>
    <span class="c1"># job_contract_mer = pd.read_pickle(os.path.join(settings.DATA_ROOT, &#39;elise/job_contract_type.pcl&#39;))</span>
    <span class="c1"># job_working_hours_mer = pd.read_pickle(os.path.join(settings.DATA_ROOT, &#39;elise/job_job_working_hours.pcl&#39;))</span>
    <span class="c1"># langmer = utils.get_language()</span>
    <span class="c1"># dmer = utils.get_driver_lic()</span>
    <span class="n">DG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gpickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_ROOT</span><span class="p">,</span> <span class="s2">&quot;elise/career_graph.pcl&quot;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Load done </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>

    <span class="c1"># Dummy default</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># data[&#39;Languages&#39;] = &#39;yes&#39;</span>
    <span class="c1"># data[&#39;Driving licence&#39;] = &#39;yes&#39;</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Age appropriateness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Disability appropriateness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>

    <span class="n">default</span> <span class="o">=</span> <span class="n">dexmodel</span><span class="o">.</span><span class="n">get_intput_attributes</span><span class="p">()</span>

    <span class="c1"># Form data</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">DexForm2</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>

        <span class="n">skp_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;skp_code&quot;</span><span class="p">])</span>
        <span class="n">up_enota</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;up_enota&quot;</span><span class="p">])</span>  <span class="c1"># Sk.Loka</span>

        <span class="n">wishes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;wishes&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">wishes_location</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;wishes_location&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">bo_lang</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;bo_lang&quot;</span><span class="p">]</span>
        <span class="n">bo_driving_lic</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;bo_driving_lic&quot;</span><span class="p">]</span>
        <span class="c1"># logger.debug(skp_code, up_enota)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;BO wishes for contract type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;full time&quot;</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;BO career wishes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;BO working hours wishes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;daily shift&quot;</span>
    <span class="c1"># Form end</span>

    <span class="n">sel_cols_lic</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DLIC_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bo_driving_lic</span><span class="p">]</span>
    <span class="n">sel_cols_lang</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LANG_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bo_lang</span><span class="p">]</span>
    <span class="n">inter</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_intermediate_results</span><span class="p">()</span>
    <span class="n">lic_lang</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;SKP-6&quot;</span><span class="p">:</span> <span class="n">inter</span><span class="p">[</span><span class="s2">&quot;SKP-6&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dlic&quot;</span><span class="p">:</span> <span class="n">inter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sel_cols_lic</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">inter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;SUM_DLIC&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dlang&quot;</span><span class="p">:</span> <span class="n">inter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sel_cols_lang</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">inter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;SUM_LANG&quot;</span><span class="p">],</span>
            <span class="s2">&quot;delovni 훾as&quot;</span><span class="p">:</span> <span class="n">inter</span><span class="p">[</span><span class="s2">&quot;delovni 훾as&quot;</span><span class="p">],</span>
            <span class="s2">&quot;koda Urnik dela&quot;</span><span class="p">:</span> <span class="n">inter</span><span class="p">[</span><span class="s2">&quot;koda Urnik dela&quot;</span><span class="p">],</span>
            <span class="s2">&quot;skills&quot;</span><span class="p">:</span> <span class="n">inter</span><span class="p">[</span><span class="s2">&quot;skills&quot;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>  <span class="c1"># .fillna(1)</span>
    <span class="n">lic_lang</span><span class="p">[[</span><span class="s2">&quot;dlic&quot;</span><span class="p">,</span> <span class="s2">&quot;dlang&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lic_lang</span><span class="p">[[</span><span class="s2">&quot;dlic&quot;</span><span class="p">,</span> <span class="s2">&quot;dlang&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># There is a case when SKP4 is listed. SKP-6 has two &#39;decimal&#39; digits. This line checks whether the code is SKP4 or SKP6</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s2">&quot;SKP koda-4&quot;</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">skp_code</span><span class="p">)</span> <span class="o">==</span> <span class="n">skp_code</span> <span class="k">else</span> <span class="s2">&quot;SKP koda-6&quot;</span>
    <span class="c1">#     bo_skills = esco.get_all_skills_SKP2ESCO(occupations,  skp_code, col_name)</span>
    <span class="n">bo_skills</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">occupations</span><span class="p">[</span><span class="n">occupations</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">skp_code</span><span class="p">][</span><span class="s2">&quot;URI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">bo_skills</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span>
            <span class="n">complete_skills_dict</span><span class="p">[</span><span class="n">uri</span><span class="p">][</span><span class="s2">&quot;basic&quot;</span><span class="p">],</span> <span class="n">complete_skills_dict</span><span class="p">[</span><span class="n">uri</span><span class="p">][</span><span class="s2">&quot;optional&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># dif_skills = skp_skills.apply(lambda x: len(np.setdiff1d(x.skills, bo_skills)), axis=1)</span>
    <span class="n">len_skill</span> <span class="o">=</span> <span class="n">skp_skills</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">skills</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">wh</span> <span class="o">=</span> <span class="n">len_skill</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">dif_skills</span> <span class="o">=</span> <span class="n">skp_skills</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">skills</span><span class="p">,</span> <span class="n">bo_skills</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">dif_skills</span><span class="p">[</span><span class="o">~</span><span class="n">wh</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">dif_skills</span><span class="p">[</span><span class="n">wh</span><span class="p">]</span> <span class="o">=</span> <span class="n">dif_skills</span><span class="p">[</span><span class="n">wh</span><span class="p">]</span> <span class="o">/</span> <span class="n">len_skill</span><span class="p">[</span><span class="n">wh</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">resSKPs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">select_positions</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">up_enota</span><span class="p">,</span> <span class="n">id_distance_time</span><span class="p">)</span>
    <span class="n">dif_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;SKP-6&quot;</span><span class="p">:</span> <span class="n">skp_skills</span><span class="p">[</span><span class="s2">&quot;SKP-6&quot;</span><span class="p">],</span> <span class="s2">&quot;diff&quot;</span><span class="p">:</span> <span class="n">dif_skills</span><span class="p">})</span>
    <span class="n">dex_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">resSKPs</span><span class="p">,</span> <span class="n">dif_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;SKP-6&quot;</span><span class="p">)</span>
    <span class="n">dex_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dex_df</span><span class="p">,</span> <span class="n">lic_lang</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;SKP-6&quot;</span><span class="p">)</span>

    <span class="n">mask_dlic</span> <span class="o">=</span> <span class="n">inter</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;DLIC_.*&quot;</span><span class="p">)</span>
    <span class="n">mask_lang</span> <span class="o">=</span> <span class="n">inter</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;LANG_.*&quot;</span><span class="p">)</span>

    <span class="n">all_eval</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">all_qq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># logger.debug(data)</span>
    <span class="n">data_val</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">dex_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">wishes</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;SKP Wish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;SKP Wish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;SKP-6&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">wishes</span> <span class="k">else</span> <span class="s2">&quot;no&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">])</span>
        <span class="c1">#### FIX THIS!!! This is for the case when the SKP2ESCO is too broad</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">]):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;SKPvsESCO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">default</span><span class="p">[</span><span class="s2">&quot;SKPvsESCO&quot;</span><span class="p">])[</span><span class="n">ind</span><span class="p">]</span>
        <span class="c1">#     ind = bisect.bisect_left([5,10], vals[&#39;diff&#39;])</span>
        <span class="c1">#     #### FIX THIS!!! This is for the case when the SKP2ESCO is too broad</span>
        <span class="c1">#     if (vals[&#39;diff&#39;] == 0):</span>
        <span class="c1">#         ind = -1</span>
        <span class="c1">#     data[&#39;SKPvsESCO&#39;] = np.flipud(default[&#39;SKPvsESCO&#39;])[ind]</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;weight_num&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;number of BO&quot;</span><span class="p">])</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Available positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span><span class="p">[</span><span class="s2">&quot;Available positions&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;distance_km&quot;</span><span class="p">])</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MSO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">default</span><span class="p">[</span><span class="s2">&quot;MSO&quot;</span><span class="p">])[</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># Language</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Languages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Driving licence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;delovni 훾as&quot;</span><span class="p">]):</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job contract type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Kraj&quot;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;delovni 훾as&quot;</span><span class="p">]:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job contract type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;part time&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job contract type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;full time&quot;</span>

        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;koda Urnik dela&quot;</span><span class="p">]):</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job working hours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;koda Urnik dela&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job working hours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;daily shift&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job working hours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;daily/night shift&quot;</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Driving licence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;dlic&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;no&quot;</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Languages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;dlang&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;no&quot;</span>

        <span class="c1"># Job career advancement</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">adv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="n">nx</span><span class="o">.</span><span class="n">all_simple_paths</span><span class="p">(</span>
                        <span class="n">DG</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">skp_code</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;SKP-4&quot;</span><span class="p">]),</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">3</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">adv</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">degrade</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="n">nx</span><span class="o">.</span><span class="n">all_simple_paths</span><span class="p">(</span>
                        <span class="n">DG</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">skp_code</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;SKP-4&quot;</span><span class="p">]),</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">3</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">degrade</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">adv</span> <span class="o">&gt;</span> <span class="n">degrade</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job career advancement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
        <span class="k">elif</span> <span class="n">adv</span> <span class="o">&lt;</span> <span class="n">degrade</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job career advancement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
        <span class="k">elif</span> <span class="n">adv</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">degrade</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job career advancement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Job career advancement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;same&quot;</span>

        <span class="c1"># Job working hours</span>

        <span class="c1"># print(vals[&#39;IDupEnote&#39;].astype(int))</span>
        <span class="c1"># BO Wish location</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;BO wish location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wishes_location</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;BO wish location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;yes&quot;</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;IDupEnote&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">wishes_location</span> <span class="k">else</span> <span class="s2">&quot;no&quot;</span>
            <span class="p">)</span>
        <span class="c1"># eval_res, qq_res = dexmodel.evaluate_model(data)</span>
        <span class="c1"># all_eval[r[0]] = eval_res</span>
        <span class="c1"># all_qq[r[0]] = qq_res</span>
        <span class="n">data_val</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span>
            <span class="n">dex_eval</span><span class="p">,</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">data_val</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">data_val</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">dexmodel</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="n">all_eval</span><span class="p">,</span> <span class="n">all_qq</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="n">all_eval</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">all_eval</span><span class="p">))</span>
    <span class="n">all_qq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">all_qq</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="n">df_qq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">all_qq</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_eval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">all_eval</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_qq</span><span class="p">[</span><span class="s1">&#39;Eval_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_qq</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;SKP Evaluation&#39;</span><span class="p">])</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_qq</span><span class="p">[</span><span class="s1">&#39;Eval_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_qq</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;SKP Evaluation&#39;</span><span class="p">])</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">final_index</span> <span class="o">=</span> <span class="n">df_qq</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Eval_max&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="c1">#.head(10).index</span>

    <span class="n">sif_skp</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_jobs</span><span class="p">()</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dex_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">],</span><span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">],</span> <span class="n">right_on</span><span class="o">=</span><span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">dex_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">sif_skp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;SFpoklicaSKP&#39;</span><span class="p">,</span><span class="s1">&#39;Naziv&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;SFpoklicaSKP&#39;</span><span class="p">),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;SKP-6&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;SFpoklicaSKP&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="c1"># final_df = pd.merge(intermediate, occupations.loc[:,[&#39;SKP koda-6&#39;,&#39;SKP poklic&#39;]], left_on=&#39;SKP-6&#39;, right_on=&#39;SKP koda-6&#39;)</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">final_df</span><span class="p">,</span><span class="n">df_qq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">,[</span><span class="s1">&#39;Eval_min&#39;</span><span class="p">,</span> <span class="s1">&#39;Eval_max&#39;</span><span class="p">]],</span>  <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key_0&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">df_qq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">final_df</span><span class="p">,</span><span class="n">df_qq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">],</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key_0&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">df_qq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_index</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_qq&#39;</span><span class="p">])</span>


    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="c1"># logger.debug(len(df_qq))</span>
    <span class="c1"># logger.debug(len(df_eval))</span>
    <span class="c1"># logger.debug(len(final_index))</span>
    <span class="c1"># logger.debug(len(intermediate))</span>
    <span class="c1"># logger.debug(len(final_df))</span>
    <span class="c1"># logger.debug(final_index)</span>

    <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">new_names</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">final_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">final_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">new_names</span><span class="p">)),</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">final_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;skills&#39;</span><span class="p">,</span><span class="s1">&#39;SFpoklicaSKP&#39;</span><span class="p">,</span><span class="s1">&#39;key_0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="s1">&#39;weight_num&#39;</span><span class="p">,</span><span class="s1">&#39;IDupEnote&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;distance_km&#39;</span><span class="p">,</span><span class="s1">&#39;travel_min&#39;</span><span class="p">,</span><span class="s1">&#39;number_of_BO&#39;</span><span class="p">])</span>
    <span class="n">tuple_convert</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Skill_appropriateness&#39;</span><span class="p">,</span> <span class="s1">&#39;Personal_characteristics&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SKP_Evaluation&#39;</span><span class="p">,</span><span class="s1">&#39;Contract_type&#39;</span><span class="p">,</span><span class="s1">&#39;Skills&#39;</span><span class="p">,</span><span class="s1">&#39;Career_advance&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Working_hours&#39;</span><span class="p">,</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span><span class="s1">&#39;Job_appropriateness&#39;</span><span class="p">,</span><span class="s1">&#39;Work_type&#39;</span><span class="p">]</span>

    <span class="n">sel_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Eval_min&#39;</span><span class="p">,</span><span class="s1">&#39;Eval_max&#39;</span><span class="p">,</span><span class="s1">&#39;delovni_훾as&#39;</span><span class="p">,</span><span class="s1">&#39;SKPvsESCO&#39;</span><span class="p">,</span><span class="s1">&#39;Available_positions&#39;</span><span class="p">,</span><span class="s1">&#39;Skill_appropriateness&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Job_contract_type&#39;</span><span class="p">,</span><span class="s1">&#39;Job_working_hours&#39;</span><span class="p">,</span><span class="s1">&#39;MSO&#39;</span><span class="p">,</span><span class="s1">&#39;Career_advance&#39;</span><span class="p">,</span><span class="s1">&#39;SKP_Evaluation&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tuple_convert</span><span class="p">:</span>
        <span class="n">final_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
        <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_qq&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_qq&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>

    <span class="n">final_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">sel_cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># dj_res = dict()</span>
    <span class="c1"># for skp in final_df[&#39;SKP-4&#39;].unique():</span>
    <span class="c1">#     wh = final_df[&#39;SKP-4&#39;] == skp</span>
    <span class="c1">#     dj_res[skp] = final_df[wh]#.to_dict(orient=&#39;list&#39;)</span>
    <span class="c1">#     # break</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">final_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span> <span class="o">!=</span> <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-4&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Naziv&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;gen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">final_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SESSION_FILE_PATH</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session_key</span> <span class="o">+</span> <span class="s2">&quot;_df.pcl&quot;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dex_res.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">})</span></div>



<div class="viewcode-block" id="dex_eval"><a class="viewcode-back" href="../../myapp.html#myapp.views.dex_eval">[docs]</a><span class="k">def</span> <span class="nf">dex_eval</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="n">eval_res</span><span class="p">,</span> <span class="n">qq_res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate_model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eval_res</span><span class="p">,</span> <span class="n">qq_res</span><span class="p">,</span> <span class="n">key</span></div>


<div class="viewcode-block" id="get_file"><a class="viewcode-back" href="../../myapp.html#myapp.views.get_file">[docs]</a><span class="k">def</span> <span class="nf">get_file</span><span class="p">():</span>
    <span class="n">filess</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">filess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filess</span></div>


<div class="viewcode-block" id="get_skills"><a class="viewcode-back" href="../../myapp.html#myapp.views.get_skills">[docs]</a><span class="k">def</span> <span class="nf">get_skills</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">skp_code</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">sif_skp</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sif_skp&quot;</span><span class="p">)</span>
    <span class="n">skp_code</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">skp_code</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sif_skp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading sif_skp&quot;</span><span class="p">)</span>
        <span class="n">sif_skp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_ROOT</span><span class="p">,</span> <span class="s2">&quot;dimSKP08.csv&quot;</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sif_skp&quot;</span><span class="p">,</span> <span class="n">sif_skp</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">occupations</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;occ&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">occupations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading occupations&quot;</span><span class="p">)</span>
        <span class="n">occupations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_ROOT</span><span class="p">,</span> <span class="s2">&quot;SKP_ESCO.xlsx&quot;</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;occ&quot;</span><span class="p">,</span> <span class="n">occupations</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">esco</span> <span class="o">=</span> <span class="n">ESCOUtil</span><span class="p">()</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s2">&quot;SKP koda-4&quot;</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">skp_code</span><span class="p">)</span> <span class="o">==</span> <span class="n">skp_code</span> <span class="k">else</span> <span class="s2">&quot;SKP koda-6&quot;</span>
    <span class="c1"># who =  occupations[col_name] == skp_code</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">esco</span><span class="o">.</span><span class="n">get_all_skills_SKP2ESCO</span><span class="p">(</span><span class="n">occupations</span><span class="p">,</span> <span class="n">skp_code</span><span class="p">,</span> <span class="n">col_name</span><span class="p">)</span>
    <span class="n">retVal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">retVal</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">esco</span><span class="o">.</span><span class="n">getLabel</span><span class="p">(</span><span class="n">r</span><span class="p">)})</span>

    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">retVal</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoder</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">skp_code</span> <span class="o">=</span> <span class="n">sif_skp</span><span class="p">[</span>
        <span class="n">sif_skp</span><span class="o">.</span><span class="n">IDpoklicaSKP</span> <span class="o">==</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;IDpoklicaSKP08&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">SFpoklicaSKP</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="c1"># There is a case when SKP4 is listed. SKP-6 has two &#39;decimal&#39; digits. This line checks whether the code is SKP4 or SKP6</span>


<div class="viewcode-block" id="handeval"><a class="viewcode-back" href="../../myapp.html#myapp.views.handeval">[docs]</a><span class="nd">@require_http_methods</span><span class="p">([</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">handeval</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">dex</span> <span class="o">=</span> <span class="n">DEXModel</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DEX_MODEL</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">DexForm</span><span class="p">(</span><span class="n">dex</span><span class="o">.</span><span class="n">get_intput_attributes</span><span class="p">(),</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>  <span class="c1"># , dex_attributes={})</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">res</span><span class="p">,</span> <span class="n">qq_res</span> <span class="o">=</span> <span class="n">dex</span><span class="o">.</span><span class="n">evaluate_model</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">)</span>
        <span class="n">dex_res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">dex_res</span><span class="p">[</span><span class="s2">&quot;quantitative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
        <span class="n">dex_res</span><span class="p">[</span><span class="s2">&quot;qualitative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qq_res</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoder</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
        <span class="c1"># return HttpResponse(str(res))</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span></div>


<div class="viewcode-block" id="hand"><a class="viewcode-back" href="../../myapp.html#myapp.views.hand">[docs]</a><span class="k">def</span> <span class="nf">hand</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">dex</span> <span class="o">=</span> <span class="n">DEXModel</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DEX_MODEL</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">DexForm</span><span class="p">(</span><span class="n">dex</span><span class="o">.</span><span class="n">get_intput_attributes</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span></div>


<div class="viewcode-block" id="dex_local_input"><a class="viewcode-back" href="../../myapp.html#myapp.views.dex_local_input">[docs]</a><span class="k">def</span> <span class="nf">dex_local_input</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">get_file</span><span class="p">()</span>
        <span class="n">dex</span> <span class="o">=</span> <span class="n">DEXModel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}{</span><span class="n">files</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dex</span><span class="o">.</span><span class="n">get_intput_attributes</span><span class="p">()</span></div>


<div class="viewcode-block" id="dex_input"><a class="viewcode-back" href="../../myapp.html#myapp.views.dex_input">[docs]</a><span class="nd">@require_http_methods</span><span class="p">([</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dex_input</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">dex</span> <span class="o">=</span> <span class="n">DEXModel</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DEX_MODEL</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">dex</span><span class="o">.</span><span class="n">get_intput_attributes</span><span class="p">(),</span> <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="dex_evaluate"><a class="viewcode-back" href="../../myapp.html#myapp.views.dex_evaluate">[docs]</a><span class="nd">@csrf_exempt</span>
<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dex_evaluate</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">dex</span> <span class="o">=</span> <span class="n">DEXModel</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DEX_MODEL</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="n">res</span><span class="p">,</span> <span class="n">qq_res</span> <span class="o">=</span> <span class="n">dex</span><span class="o">.</span><span class="n">evaluate_model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">dex_res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dex_res</span><span class="p">[</span><span class="s2">&quot;quantitative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
    <span class="n">dex_res</span><span class="p">[</span><span class="s2">&quot;qualitative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qq_res</span>

    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">dex_res</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoder</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span></div>


<div class="viewcode-block" id="my_view"><a class="viewcode-back" href="../../myapp.html#myapp.views.my_view">[docs]</a><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Upload as many files as you want!&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DocumentForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">newdoc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">docfile</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s2">&quot;docfile&quot;</span><span class="p">])</span>
            <span class="n">newdoc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;my-view&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;The form is not valid. Fix the following error:&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DocumentForm</span><span class="p">()</span>

    <span class="n">documents</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;documents&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span> <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;list.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></div>


<div class="viewcode-block" id="skp_view"><a class="viewcode-back" href="../../myapp.html#myapp.views.skp_view">[docs]</a><span class="k">def</span> <span class="nf">skp_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DexForm2</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DexForm2</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;gen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name copy.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<div class="viewcode-block" id="occupation_similarty_skp6"><a class="viewcode-back" href="../../myapp.html#myapp.views.occupation_similarty_skp6">[docs]</a><span class="k">def</span> <span class="nf">occupation_similarty_skp6</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">skp6</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skp6&quot;</span><span class="p">))</span>
    <span class="n">skp2esco</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_occupation</span><span class="p">()</span>
    <span class="n">wh</span> <span class="o">=</span> <span class="n">skp2esco</span><span class="p">[</span><span class="s2">&quot;SKP koda-6&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">skp6</span>

    <span class="n">occupations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_mapping_occ</span><span class="p">()</span>
    <span class="n">W_combined</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_similarity_matrix</span><span class="p">()</span>

    <span class="n">w_nesta</span> <span class="o">=</span> <span class="n">occupations</span><span class="o">.</span><span class="n">concept_uri</span> <span class="o">==</span> <span class="n">skp2esco</span><span class="p">[</span><span class="n">wh</span><span class="p">]</span><span class="o">.</span><span class="n">URI</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">occupation_id</span> <span class="o">=</span> <span class="n">occupations</span><span class="p">[</span><span class="n">w_nesta</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">most_similar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">W_combined</span><span class="p">[</span><span class="n">occupation_id</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">W_combined</span><span class="p">[</span><span class="n">occupation_id</span><span class="p">,</span> <span class="p">:]))</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">occupations</span><span class="p">[[</span><span class="s2">&quot;preferred_label&quot;</span><span class="p">,</span> <span class="s2">&quot;concept_uri&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">most_similar</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;similarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">similarity</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">skp2esco</span><span class="p">[[</span><span class="s2">&quot;URI&quot;</span><span class="p">,</span> <span class="s2">&quot;SKP koda-6&quot;</span><span class="p">]],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;concept_uri&quot;</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;URI&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;URI&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># df.head(100)</span>

    <span class="c1"># return HttpResponse(df.head(10).to_json(), content_type = &#39;application/json&#39;)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">())</span></div>


<div class="viewcode-block" id="occupation_similarity"><a class="viewcode-back" href="../../myapp.html#myapp.views.occupation_similarity">[docs]</a><span class="k">def</span> <span class="nf">occupation_similarity</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">)</span>
    <span class="n">occupations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_mapping_occ</span><span class="p">()</span>
    <span class="n">W_combined</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_similarity_matrix</span><span class="p">()</span>
    <span class="n">wh</span> <span class="o">=</span> <span class="n">occupations</span><span class="o">.</span><span class="n">concept_uri</span> <span class="o">==</span> <span class="n">uri</span>
    <span class="n">occupation_id</span> <span class="o">=</span> <span class="n">occupations</span><span class="p">[</span><span class="n">wh</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">most_similar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">W_combined</span><span class="p">[</span><span class="n">occupation_id</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">W_combined</span><span class="p">[</span><span class="n">occupation_id</span><span class="p">,</span> <span class="p">:]))</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">occupations</span><span class="p">[[</span><span class="s2">&quot;preferred_label&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">most_similar</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;similarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">similarity</span>

    <span class="c1"># return HttpResponse(df.head(10).to_json(), content_type = &#39;application/json&#39;)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">())</span></div>

<div class="viewcode-block" id="view_test"><a class="viewcode-back" href="../../myapp.html#myapp.views.view_test">[docs]</a><span class="k">def</span> <span class="nf">view_test</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATA_ROOT</span><span class="p">,</span> <span class="s1">&#39;dex_testing.pcl&#39;</span><span class="p">))</span>
    <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">new_names</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">final_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">final_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">new_names</span><span class="p">)),</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">final_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;skills&#39;</span><span class="p">,</span><span class="s1">&#39;SFpoklicaSKP&#39;</span><span class="p">,</span><span class="s1">&#39;key_0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="s1">&#39;weight_num&#39;</span><span class="p">,</span><span class="s1">&#39;IDupEnote&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;distance_km&#39;</span><span class="p">,</span><span class="s1">&#39;travel_min&#39;</span><span class="p">,</span><span class="s1">&#39;number_of_BO&#39;</span><span class="p">])</span>
    <span class="n">tuple_convert</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Skill_appropriateness&#39;</span><span class="p">,</span> <span class="s1">&#39;Personal_characteristics&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SKP_Evaluation&#39;</span><span class="p">,</span><span class="s1">&#39;Contract_type&#39;</span><span class="p">,</span><span class="s1">&#39;Skills&#39;</span><span class="p">,</span><span class="s1">&#39;Career_advance&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Working_hours&#39;</span><span class="p">,</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span><span class="s1">&#39;Job_appropriateness&#39;</span><span class="p">,</span><span class="s1">&#39;Work_type&#39;</span><span class="p">]</span>

    <span class="n">sel_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Eval_min&#39;</span><span class="p">,</span><span class="s1">&#39;Eval_max&#39;</span><span class="p">,</span><span class="s1">&#39;delovni_훾as&#39;</span><span class="p">,</span><span class="s1">&#39;SKPvsESCO&#39;</span><span class="p">,</span><span class="s1">&#39;Available_positions&#39;</span><span class="p">,</span><span class="s1">&#39;Skill_appropriateness&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Job_contract_type&#39;</span><span class="p">,</span><span class="s1">&#39;Job_working_hours&#39;</span><span class="p">,</span><span class="s1">&#39;MSO&#39;</span><span class="p">,</span><span class="s1">&#39;Career_advance&#39;</span><span class="p">,</span><span class="s1">&#39;SKP_Evaluation&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tuple_convert</span><span class="p">:</span>
        <span class="n">final_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
        <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_qq&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_qq&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>

    <span class="n">final_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">sel_cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># dj_res = dict()</span>
    <span class="c1"># for skp in final_df[&#39;SKP-4&#39;].unique():</span>
    <span class="c1">#     wh = final_df[&#39;SKP-4&#39;] == skp</span>
    <span class="c1">#     dj_res[skp] = final_df[wh]#.to_dict(orient=&#39;list&#39;)</span>
    <span class="c1">#     # break</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">final_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span> <span class="o">!=</span> <span class="n">final_df</span><span class="p">[</span><span class="s1">&#39;SKP-4&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Naziv&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;gen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">final_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SESSION_FILE_PATH</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session_key</span> <span class="o">+</span> <span class="s2">&quot;_df.pcl&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dex_res.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">})</span></div>



<div class="viewcode-block" id="index_plotly"><a class="viewcode-back" href="../../myapp.html#myapp.views.index_plotly">[docs]</a><span class="k">def</span> <span class="nf">index_plotly</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">json_string</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">all_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SESSION_FILE_PATH</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session_key</span> <span class="o">+</span> <span class="s2">&quot;_df.pcl&quot;</span><span class="p">))</span>

    <span class="n">sel_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SKPvsESCO&#39;</span><span class="p">,</span><span class="s1">&#39;Available_positions&#39;</span><span class="p">,</span><span class="s1">&#39;Skill_appropriateness&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Job_contract_type&#39;</span><span class="p">,</span><span class="s1">&#39;Job_working_hours&#39;</span><span class="p">,</span><span class="s1">&#39;MSO&#39;</span><span class="p">,</span><span class="s1">&#39;Career_advance&#39;</span><span class="p">,</span><span class="s1">&#39;SKP_Evaluation&#39;</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">all_index</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_qq&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sel_cols</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatterpolar</span><span class="p">(</span>
          <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
          <span class="n">theta</span><span class="o">=</span><span class="n">sel_cols</span><span class="p">,</span>
          <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;toself&#39;</span><span class="p">,</span>
          <span class="n">name</span><span class="o">=</span><span class="n">final_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="s1">&#39;Naziv&#39;</span><span class="p">]</span>
        <span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
      <span class="n">polar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">radialaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
          <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
      <span class="p">),</span>
      <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">plot_div</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span>
               <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;div&#39;</span><span class="p">,</span><span class="n">include_plotlyjs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">show_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">link_text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;displaylogo&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">plot_div</span><span class="p">)</span></div>
    <span class="c1"># return render(request, &quot;index.html&quot;, context={&#39;plot_div&#39;: plot_div})</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">HECAT</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">hecat_django</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Viktor Andonovic.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>